/*!
 * Start Bootstrap - SB Admin 2 v4.1.4 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2022 Start Bootstrap
 * Licensed under UNLICENSED (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

function init_coord(){reglage_chair={siege:{assise:{largeur:35,profondeur:40,hauteur:45,angle:10,distanceFourche:0},dossier:{largeur:40,hauteur:20,angle:90},potence:{longueur:35,angle:90},repose:{longueur:15,largeur:5,angle:90}},roue:{avt:{deport:50,voie:18,rayon:5,carrosage:0},arr:{deport:0,voie:20,rayon:30,carrosage:0,MC_distance:3.5,MC_rayon:28}}},reglage_patient={bras:{angle:45},main:{angle:0}};var e=175;patient={taille:e,Lpied:.146*e,Ltibia:43.05,Lcuisse:42.875,Lbassin:30.45,Htronc:.34*e,Lepaule:45.325,Ltete:22.75,Lbras:23.8,LavtBras:.146*e,Lmain:6.3,lbassin:17.5,ltronc:26.25},patient.ltete=.75*patient.Ltete,patient.lpied=.5*patient.ltete,patient.lcuisse=.3*patient.Lcuisse,patient.ltibia=.3*patient.Ltibia,patient.lbras=.4*patient.Lbras,patient.lavtBras=.4*patient.LavtBras,patient.ptronc=1/3*patient.Htronc,patient.pbras=patient.lbras,patient.pavtBras=patient.lavtBras,patient.pointure=Math.ceil(3*(patient.Lpied+1)/2)}function init_global(){data=Array(),init_data(),Plotly.react("myPloty3DChart",data,plotly_layout,plotly_config)}function init_data(){cal_repere_chair(),cal_points_chair(),cal_mesh_chair(),cal_repere_patient(),cal_mesh_patient()}function cal_repere_chair(){repere_chair={siege:{assise:cal_repere_assise(reglage_chair.roue.arr.deport,reglage_chair.siege.assise.hauteur,reglage_chair.siege.assise.profondeur,reglage_chair.siege.assise.angle),potence:cal_repere_potence(reglage_chair.siege.assise.profondeur,reglage_chair.siege.potence.longueur,reglage_chair.siege.potence.angle),repose:cal_repere_repose(reglage_chair.siege.repose.angle)},roue:{avt:{g:cal_repere_roue(-1,reglage_chair.roue.avt.deport,reglage_chair.roue.avt.rayon,reglage_chair.roue.avt.voie,reglage_chair.roue.avt.carrosage),d:cal_repere_roue(1,reglage_chair.roue.avt.deport,reglage_chair.roue.avt.rayon,reglage_chair.roue.avt.voie,reglage_chair.roue.avt.carrosage)},arr:{g:cal_repere_roue(-1,reglage_chair.roue.arr.deport,reglage_chair.roue.arr.rayon,reglage_chair.roue.arr.voie,reglage_chair.roue.arr.carrosage),d:cal_repere_roue(1,reglage_chair.roue.arr.deport,reglage_chair.roue.arr.rayon,reglage_chair.roue.arr.voie,reglage_chair.roue.arr.carrosage)},mc:{g:cal_repere_roue(-1,reglage_chair.roue.arr.deport,reglage_chair.roue.arr.rayon,reglage_chair.roue.arr.voie,reglage_chair.roue.arr.carrosage),d:cal_repere_roue(1,reglage_chair.roue.arr.deport,reglage_chair.roue.arr.rayon,reglage_chair.roue.arr.voie,reglage_chair.roue.arr.carrosage)}}},repere_chair.siege.repose=math.multiply(math.multiply(repere_chair.siege.assise,repere_chair.siege.potence),repere_chair.siege.repose),repere_chair.siege.potence=math.multiply(repere_chair.siege.assise,repere_chair.siege.potence)}function cal_points_chair(){for(var e in points_chair={siege:{assise:{AvtDroit1:[reglage_chair.siege.assise.profondeur,0,reglage_chair.siege.assise.largeur/2],AvtDroit2:[reglage_chair.siege.assise.profondeur,3,reglage_chair.siege.assise.largeur/2],AvtGauche1:[reglage_chair.siege.assise.profondeur,0,-reglage_chair.siege.assise.largeur/2],AvtGauche2:[reglage_chair.siege.assise.profondeur,3,-reglage_chair.siege.assise.largeur/2],ArrDroit1:[0,0,reglage_chair.siege.assise.largeur/2],ArrDroit2:[0,3,reglage_chair.siege.assise.largeur/2],ArrGauche1:[0,0,-reglage_chair.siege.assise.largeur/2],ArrGauche2:[0,3,-reglage_chair.siege.assise.largeur/2]},fourche:{g:[0,reglage_chair.roue.arr.rayon-reglage_chair.roue.avt.rayon,0],d:[0,reglage_chair.roue.arr.rayon-reglage_chair.roue.avt.rayon,0]},fourcheBas:{g:[0,0,0],d:[0,0,0]},dossier:{g:[-reglage_chair.siege.dossier.hauteur*Math.sin((reglage_chair.siege.dossier.angle-90)*Math.PI/180),reglage_chair.siege.dossier.hauteur*Math.cos((reglage_chair.siege.dossier.angle-90)*Math.PI/180),reglage_chair.siege.dossier.largeur/2],d:[-reglage_chair.siege.dossier.hauteur*Math.sin((reglage_chair.siege.dossier.angle-90)*Math.PI/180),reglage_chair.siege.dossier.hauteur*Math.cos((reglage_chair.siege.dossier.angle-90)*Math.PI/180),-reglage_chair.siege.dossier.largeur/2]},potence:{g:[0,0,-reglage_chair.siege.assise.largeur/2],d:[0,0,reglage_chair.siege.assise.largeur/2]},repose:{g:[[-reglage_chair.siege.repose.largeur/2,0,-reglage_chair.siege.assise.largeur/2],[reglage_chair.siege.repose.largeur/2,0,-reglage_chair.siege.assise.largeur/2],[reglage_chair.siege.repose.largeur/2,0,reglage_chair.siege.repose.longueur-reglage_chair.siege.assise.largeur/2],[-reglage_chair.siege.repose.largeur/2,0,reglage_chair.siege.repose.longueur-reglage_chair.siege.assise.largeur/2]],d:[[-reglage_chair.siege.repose.largeur/2,0,reglage_chair.siege.assise.largeur/2],[reglage_chair.siege.repose.largeur/2,0,reglage_chair.siege.assise.largeur/2],[reglage_chair.siege.repose.largeur/2,0,reglage_chair.siege.assise.largeur/2-reglage_chair.siege.repose.longueur],[-reglage_chair.siege.repose.largeur/2,0,reglage_chair.siege.assise.largeur/2-reglage_chair.siege.repose.longueur]]}},roue:{avt:{g:cercle([0,0,0],reglage_chair.roue.avt.rayon,-1,0),d:cercle([0,0,0],reglage_chair.roue.avt.rayon,1,0)},arr:{g:cercle([0,0,0],reglage_chair.roue.arr.rayon,-1,0),d:cercle([0,0,0],reglage_chair.roue.arr.rayon,1,0)},mc:{g:cercle([0,0,0],reglage_chair.roue.arr.MC_rayon,-1,reglage_chair.roue.arr.MC_distance),d:cercle([0,0,0],reglage_chair.roue.arr.MC_rayon,1,reglage_chair.roue.arr.MC_distance)}},roue_centre:{avt:{g:[0,0,0,1],d:[0,0,0,1]},arr:{g:[0,0,0,1],d:[0,0,0,1]},mc:{g:[0,0,0,1],d:[0,0,0,1]}}},points_chair.roue)for(var a in points_chair.roue[e])points_chair.roue[e][a].push(new Array(points_chair.roue[e][a][0].length).fill(1));for(var i in points_chair.siege.fourche)points_chair.siege.fourche[i].push(1);for(var r in points_chair.siege.fourcheBas)points_chair.siege.fourcheBas[r].push(1);for(var t in points_chair.siege.assise)points_chair.siege.assise[t].push(1);for(var s in points_chair.siege.dossier)points_chair.siege.dossier[s].push(1);for(var n in points_chair.siege.potence)points_chair.siege.potence[n].push(1);for(var o in points_chair.siege.repose)for(var p in points_chair.siege.repose[o])points_chair.siege.repose[o][p].push(1);for(var c in points_chair.roue)for(var l in points_chair.roue[c]){for(var h in points_chair.roue[c][l]=matrice_transpose(points_chair.roue[c][l]),points_chair.roue[c][l])points_chair.roue[c][l][h]=math.multiply(repere_chair.roue[c][l],points_chair.roue[c][l][h]);points_chair.roue[c][l]=matrice_transpose(points_chair.roue[c][l])}for(var g in points_chair.roue_centre)for(var u in points_chair.roue_centre[g])points_chair.roue_centre[g][u]=math.multiply(repere_chair.roue[g][u],points_chair.roue_centre[g][u]);for(var _ in points_chair.siege.fourche)points_chair.siege.fourche[_]=math.multiply(repere_chair.roue.avt[_],points_chair.siege.fourche[_]);for(var m in points_chair.siege.fourcheBas)points_chair.siege.fourcheBas[m]=math.multiply(repere_chair.roue.avt[m],points_chair.siege.fourcheBas[m]);for(var d in points_chair.siege.assise)points_chair.siege.assise[d]=math.multiply(repere_chair.siege.assise,points_chair.siege.assise[d]);for(var y in points_chair.siege.dossier)points_chair.siege.dossier[y]=math.multiply(repere_chair.siege.assise,points_chair.siege.dossier[y]);for(var v in points_chair.siege.potence)points_chair.siege.potence[v]=math.multiply(repere_chair.siege.potence,points_chair.siege.potence[v]);for(var f in points_chair.siege.repose)for(var x in points_chair.siege.repose[f])points_chair.siege.repose[f][x]=math.multiply(repere_chair.siege.repose,points_chair.siege.repose[f][x])}function cal_mesh_chair(){var e,a={siege:{assise:"red"},roue:{avt:"green",arr:"green",mc:"red"}},i={roue:{avt:10,arr:14,mc:8}};for(e in points_chair.roue)for(var r in points_chair.roue[e]){r={type:"scatter3d",mode:"lines",marker:{color:a.roue[e]},line:{width:i.roue[e]},x:points_chair.roue[e][r][0],y:points_chair.roue[e][r][2],z:points_chair.roue[e][r][1]};data.push(r)}for(let a=0;a<4;a+=1)for(let e=0;e<(data[a].x.length-1)/2;e+=2){var t={type:"scatter3d",mode:"lines",opacity:.2,marker:{color:"black"},line:{width:3},x:[data[a].x[e],data[a].x[e+(data[a].x.length-1)/2]],y:[data[a].y[e],data[a].y[e+(data[a].x.length-1)/2]],z:[data[a].z[e],data[a].z[e+(data[a].x.length-1)/2]]};data.push(t)}var s=[[points_chair.siege.assise.AvtDroit1[0],points_chair.siege.assise.AvtGauche1[0],points_chair.siege.assise.ArrDroit1[0],points_chair.siege.assise.ArrGauche1[0]],[points_chair.siege.assise.AvtDroit2[0],points_chair.siege.assise.AvtGauche2[0],points_chair.siege.assise.ArrDroit2[0],points_chair.siege.assise.ArrGauche2[0]],[points_chair.siege.assise.AvtDroit1[0],points_chair.siege.assise.AvtGauche1[0],points_chair.siege.assise.AvtDroit2[0],points_chair.siege.assise.AvtGauche2[0]],[points_chair.siege.assise.ArrDroit1[0],points_chair.siege.assise.ArrGauche1[0],points_chair.siege.assise.ArrDroit2[0],points_chair.siege.assise.ArrGauche2[0]],[points_chair.siege.assise.AvtDroit1[0],points_chair.siege.assise.ArrDroit1[0],points_chair.siege.assise.AvtDroit2[0],points_chair.siege.assise.ArrDroit2[0]],[points_chair.siege.assise.AvtGauche1[0],points_chair.siege.assise.ArrGauche1[0],points_chair.siege.assise.AvtGauche2[0],points_chair.siege.assise.ArrGauche2[0]],[points_chair.siege.assise.ArrGauche2[0],points_chair.siege.assise.ArrDroit2[0],points_chair.siege.dossier.g[0],points_chair.siege.dossier.d[0]]],n=[[points_chair.siege.assise.AvtDroit1[2],points_chair.siege.assise.AvtGauche1[2],points_chair.siege.assise.ArrDroit1[2],points_chair.siege.assise.ArrGauche1[2]],[points_chair.siege.assise.AvtDroit2[2],points_chair.siege.assise.AvtGauche2[2],points_chair.siege.assise.ArrDroit2[2],points_chair.siege.assise.ArrGauche2[2]],[points_chair.siege.assise.AvtDroit1[2],points_chair.siege.assise.AvtGauche1[2],points_chair.siege.assise.AvtDroit2[2],points_chair.siege.assise.AvtGauche2[2]],[points_chair.siege.assise.ArrDroit1[2],points_chair.siege.assise.ArrGauche1[2],points_chair.siege.assise.ArrDroit2[2],points_chair.siege.assise.ArrGauche2[2]],[points_chair.siege.assise.AvtDroit1[2],points_chair.siege.assise.ArrDroit1[2],points_chair.siege.assise.AvtDroit2[2],points_chair.siege.assise.ArrDroit2[2]],[points_chair.siege.assise.AvtGauche1[2],points_chair.siege.assise.ArrGauche1[2],points_chair.siege.assise.AvtGauche2[2],points_chair.siege.assise.ArrGauche2[2]],[points_chair.siege.assise.ArrGauche2[2],points_chair.siege.assise.ArrDroit2[2],points_chair.siege.dossier.g[2],points_chair.siege.dossier.d[2]]],o=[[points_chair.siege.assise.AvtDroit1[1],points_chair.siege.assise.AvtGauche1[1],points_chair.siege.assise.ArrDroit1[1],points_chair.siege.assise.ArrGauche1[1]],[points_chair.siege.assise.AvtDroit2[1],points_chair.siege.assise.AvtGauche2[1],points_chair.siege.assise.ArrDroit2[1],points_chair.siege.assise.ArrGauche2[1]],[points_chair.siege.assise.AvtDroit1[1],points_chair.siege.assise.AvtGauche1[1],points_chair.siege.assise.AvtDroit2[1],points_chair.siege.assise.AvtGauche2[1]],[points_chair.siege.assise.ArrDroit1[1],points_chair.siege.assise.ArrGauche1[1],points_chair.siege.assise.ArrDroit2[1],points_chair.siege.assise.ArrGauche2[1]],[points_chair.siege.assise.AvtDroit1[1],points_chair.siege.assise.ArrDroit1[1],points_chair.siege.assise.AvtDroit2[1],points_chair.siege.assise.ArrDroit2[1]],[points_chair.siege.assise.AvtGauche1[1],points_chair.siege.assise.ArrGauche1[1],points_chair.siege.assise.AvtGauche2[1],points_chair.siege.assise.ArrGauche2[1]],[points_chair.siege.assise.ArrGauche2[1],points_chair.siege.assise.ArrDroit2[1],points_chair.siege.dossier.g[1],points_chair.siege.dossier.d[1]]];let p;for(let e=0;e<7;e++)p=4<=e&&e<6?{type:"scatter3d",mode:"none",surfaceaxis:1,surfacecolor:"blue",x:s[e],y:n[e],z:o[e]}:{type:"mesh3d",x:s[e],y:n[e],z:o[e]},data.push(p);var c,l,h,g=["AvtGauche1","AvtDroit1"];for(c in points_chair.siege.potence)p={type:"scatter3d",mode:"lines",opacity:1,marker:{},line:{color:"black",width:8},x:[points_chair.siege.assise[g[Object.keys(points_chair.siege.potence).indexOf(c)]][0],points_chair.siege.potence[c][0]],y:[-points_chair.siege.assise[g[Object.keys(points_chair.siege.potence).indexOf(c)]][2],-points_chair.siege.potence[c][2]],z:[points_chair.siege.assise[g[Object.keys(points_chair.siege.potence).indexOf(c)]][1],points_chair.siege.potence[c][1]]},data.push(p);for(l in points_chair.siege.repose)p={type:"scatter3d",mode:"lines",opacity:.2,surfaceaxis:2,marker:{color:"red"},line:{width:3},x:matrice_transpose(points_chair.siege.repose[l])[0],y:math.multiply(matrice_transpose(points_chair.siege.repose[l])[2],-1),z:matrice_transpose(points_chair.siege.repose[l])[1]},data.push(p);let u=Array();for(h in u.push(matrice_transpose([points_chair.roue_centre.arr.g,points_chair.roue_centre.arr.d])),u.push(matrice_transpose([points_chair.siege.assise.ArrGauche1,points_chair.roue_centre.arr.g,points_chair.siege.fourche.g,points_chair.siege.fourcheBas.g])),u.push(matrice_transpose([points_chair.siege.assise.ArrDroit1,points_chair.roue_centre.arr.d,points_chair.siege.fourche.d,points_chair.siege.fourcheBas.d])),u)p={type:"scatter3d",mode:"lines",opacity:.6,marker:{color:"grey"},line:{width:4},x:u[h][0],y:u[h][2],z:u[h][1]},data.push(p)}function cal_repere_patient(){repere_patient={};var e=reglage_chair.siege.dossier.angle,a=reglage_patient.bras.angle,i=reglage_chair.siege.potence.angle,r=repere_chair.siege.assise,t=matrice_Rotation("x",90,4),s=patient.Lbassin,n=patient.lbassin/2,o=patient.Htronc,p=patient.Lepaule/2,c=patient.Lcuisse,l=patient.lcuisse/2,h=(patient.Ltibia,patient.ltibia,[n,3+n,0,1]),g=math.multiply(r,h);let u=math.transpose(r);u[3]=g,u=math.transpose(u);var _=math.multiply(t,u);repere_patient.bassin=_;var m=matSlice(r),d=matrice_Rotation("z",e-90,3),y=matComb(y=math.multiply(d,m),u),_=math.multiply(t,y);repere_patient.tronc=_;e=math.multiply(y,[0,o-5/4*n,p,1]),m=matrice_Rotation("x",-a,3),_=matSlice(y);let v=matComb(_=math.multiply(m,_),u);v=math.transpose(v),v[3]=e,v=math.transpose(v);e=math.multiply(t,v);repere_patient.brasD=e;p=math.multiply(y,[0,o-5/4*n,-p,1]),a=matrice_Rotation("x",a,3),y=matSlice(y);let f=matComb(y=math.multiply(a,y),u);f=math.transpose(f),f[3]=p,f=math.transpose(f);p=math.multiply(t,f);repere_patient.brasG=p,h=[n/2+c,3+l,-(s-l)/2,1],g=math.multiply(r,h);let x=math.transpose(r);x[3]=g,x=math.transpose(x);g=math.multiply(t,x);repere_patient.cuisseD=g;let b=math.multiply(t,x);b[1][3]=-1*b[1][3],repere_patient.cuisseG=b;r=matSlice(r),d=matrice_Rotation("z",i-90,3),d=matComb(d=math.multiply(d,r),x),r=math.multiply(t,d);repere_patient.tibiaD=r;let D=math.multiply(t,d);D[1][3]=-1*D[1][3],repere_patient.tibiaG=D}function cal_mesh_patient(){var e,a,i,r,t,s,n,o,p,c,l,h,g,u,_,m;let d={},y={};for(e in point_coude(),d.tronc={},[0,1]){for(var v in[d.tronc.x,d.tronc.y,d.tronc.z]=ellipsoid(0,patient.Htronc/2,0,patient.ptronc,patient.Htronc,patient.ltronc,8,e),d.tronc.x)for(var f in d.tronc.x[v]){var x=math.multiply(repere_patient.tronc,[d.tronc.x[v][f],d.tronc.y[v][f],d.tronc.z[v][f],1]);d.tronc.x[v][f]=x[0],d.tronc.y[v][f]=x[1],d.tronc.z[v][f]=x[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.tronc.x.flat(),y:d.tronc.y.flat(),z:d.tronc.z.flat()},data.push(y)}for(a in d.tete={},[0,1]){for(var b in[d.tete.x,d.tete.y,d.tete.z]=ellipsoid(0,patient.Htronc+.5*patient.Ltete,0,patient.ltete,patient.Ltete,patient.ltete,8,a),d.tete.x)for(var D in d.tete.x[b]){var G=math.multiply(repere_patient.tronc,[d.tete.x[b][D],d.tete.y[b][D],d.tete.z[b][D],1]);d.tete.x[b][D]=G[0],d.tete.y[b][D]=G[1],d.tete.z[b][D]=G[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.tete.x.flat(),y:d.tete.y.flat(),z:d.tete.z.flat()},data.push(y)}for(i in d.epaule={},[0,1]){for(var z in[d.epaule.x,d.epaule.y,d.epaule.z]=ellipsoid(0,patient.Htronc-5/8*patient.lbassin,0,patient.lbassin,patient.lbassin,patient.Lepaule,8,i),d.epaule.x)for(var A in d.epaule.x[z]){var M=math.multiply(repere_patient.tronc,[d.epaule.x[z][A],d.epaule.y[z][A],d.epaule.z[z][A],1]);d.epaule.x[z][A]=M[0],d.epaule.y[z][A]=M[1],d.epaule.z[z][A]=M[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.epaule.x.flat(),y:d.epaule.y.flat(),z:d.epaule.z.flat()},data.push(y)}for(r in d.brasD={},[0,1]){for(var B in[d.brasD.x,d.brasD.y,d.brasD.z]=ellipsoid(0,-.5*patient.Lbras,0,patient.lbras,patient.Lbras,patient.pbras,8,r),d.brasD.x)for(var L in d.brasD.x[B]){var w=math.multiply(repere_patient.brasD,[d.brasD.x[B][L],d.brasD.y[B][L],d.brasD.z[B][L],1]);d.brasD.x[B][L]=w[0],d.brasD.y[B][L]=w[1],d.brasD.z[B][L]=w[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.brasD.x.flat(),y:d.brasD.y.flat(),z:d.brasD.z.flat()},data.push(y)}for(t in d.brasG={},[0,1]){for(var I in[d.brasG.x,d.brasG.y,d.brasG.z]=ellipsoid(0,-.5*patient.Lbras,0,patient.lbras,patient.Lbras,patient.pbras,8,t),d.brasG.x)for(var P in d.brasG.x[I]){var k=math.multiply(repere_patient.brasG,[d.brasG.x[I][P],d.brasG.y[I][P],d.brasG.z[I][P],1]);d.brasG.x[I][P]=k[0],d.brasG.y[I][P]=k[1],d.brasG.z[I][P]=k[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.brasG.x.flat(),y:d.brasG.y.flat(),z:d.brasG.z.flat()},data.push(y)}for(s in d.avtBrasD={},[0,1]){for(var C in[d.avtBrasD.x,d.avtBrasD.y,d.avtBrasD.z]=ellipsoid(0,-.5*(patient.LavtBras+patient.Lmain),0,patient.lavtBras,patient.LavtBras,patient.pavtBras,8,s),d.avtBrasD.x)for(var R in d.avtBrasD.x[C]){var H=math.multiply(repere_patient.avtBrasD,[d.avtBrasD.x[C][R],d.avtBrasD.y[C][R],d.avtBrasD.z[C][R],1]);d.avtBrasD.x[C][R]=H[0],d.avtBrasD.y[C][R]=H[1],d.avtBrasD.z[C][R]=H[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.avtBrasD.x.flat(),y:d.avtBrasD.y.flat(),z:d.avtBrasD.z.flat()},data.push(y)}for(n in d.avtBrasG={},[0,1]){for(var O in[d.avtBrasG.x,d.avtBrasG.y,d.avtBrasG.z]=ellipsoid(0,-.5*(patient.LavtBras+patient.Lmain),0,patient.lavtBras,patient.LavtBras,patient.pavtBras,8,n),d.avtBrasG.x)for(var q in d.avtBrasG.x[O]){var E=math.multiply(repere_patient.avtBrasG,[d.avtBrasG.x[O][q],d.avtBrasG.y[O][q],d.avtBrasG.z[O][q],1]);d.avtBrasG.x[O][q]=E[0],d.avtBrasG.y[O][q]=E[1],d.avtBrasG.z[O][q]=E[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.avtBrasG.x.flat(),y:d.avtBrasG.y.flat(),z:d.avtBrasG.z.flat()},data.push(y)}for(o in d.mainD={},[0,1]){for(var S in[d.mainD.x,d.mainD.y,d.mainD.z]=ellipsoid(0,-(patient.LavtBras+patient.Lmain),0,.5*patient.lavtBras,patient.Lmain,.5*patient.pavtBras,8,o),d.mainD.x)for(var j in d.mainD.x[S]){var T=math.multiply(repere_patient.avtBrasD,[d.mainD.x[S][j],d.mainD.y[S][j],d.mainD.z[S][j],1]);d.mainD.x[S][j]=T[0],d.mainD.y[S][j]=T[1],d.mainD.z[S][j]=T[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.mainD.x.flat(),y:d.mainD.y.flat(),z:d.mainD.z.flat()},data.push(y)}for(p in d.mainG={},[0,1]){for(var F in[d.mainG.x,d.mainG.y,d.mainG.z]=ellipsoid(0,-(patient.LavtBras+patient.Lmain),0,.5*patient.lavtBras,patient.Lmain,.5*patient.pavtBras,8,p),d.mainG.x)for(var J in d.mainG.x[F]){var K=math.multiply(repere_patient.avtBrasG,[d.mainG.x[F][J],d.mainG.y[F][J],d.mainG.z[F][J],1]);d.mainG.x[F][J]=K[0],d.mainG.y[F][J]=K[1],d.mainG.z[F][J]=K[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.mainG.x.flat(),y:d.mainG.y.flat(),z:d.mainG.z.flat()},data.push(y)}for(c in d.bassin={},[0,1]){for(var N in[d.bassin.x,d.bassin.y,d.bassin.z]=ellipsoid(0,0,0,patient.lbassin,patient.lbassin,patient.Lbassin,8,c),d.bassin.x)for(var Q in d.bassin.x[N]){var U=math.multiply(repere_patient.bassin,[d.bassin.x[N][Q],d.bassin.y[N][Q],d.bassin.z[N][Q],1]);d.bassin.x[N][Q]=U[0],d.bassin.y[N][Q]=U[1],d.bassin.z[N][Q]=U[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.bassin.x.flat(),y:d.bassin.y.flat(),z:d.bassin.z.flat()},data.push(y)}for(l in d.cuisseD={},[0,1]){for(var V in[d.cuisseD.x,d.cuisseD.y,d.cuisseD.z]=ellipsoid(-.5*patient.Lcuisse,0,0,patient.Lcuisse,patient.lcuisse,patient.lcuisse,8,l),d.cuisseD.x)for(var W in d.cuisseD.x[V]){var X=math.multiply(repere_patient.cuisseD,[d.cuisseD.x[V][W],d.cuisseD.y[V][W],d.cuisseD.z[V][W],1]);d.cuisseD.x[V][W]=X[0],d.cuisseD.y[V][W]=X[1],d.cuisseD.z[V][W]=X[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.cuisseD.x.flat(),y:d.cuisseD.y.flat(),z:d.cuisseD.z.flat()},data.push(y)}for(h in d.cuisseG={},[0,1]){for(var Y in[d.cuisseG.x,d.cuisseG.y,d.cuisseG.z]=ellipsoid(-.5*patient.Lcuisse,0,0,patient.Lcuisse,patient.lcuisse,patient.lcuisse,8,h),d.cuisseG.x)for(var Z in d.cuisseG.x[Y]){var $=math.multiply(repere_patient.cuisseG,[d.cuisseG.x[Y][Z],d.cuisseG.y[Y][Z],d.cuisseG.z[Y][Z],1]);d.cuisseG.x[Y][Z]=$[0],d.cuisseG.y[Y][Z]=$[1],d.cuisseG.z[Y][Z]=$[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.cuisseG.x.flat(),y:d.cuisseG.y.flat(),z:d.cuisseG.z.flat()},data.push(y)}for(g in d.tibiaD={},[0,1]){for(var ee in[d.tibiaD.x,d.tibiaD.y,d.tibiaD.z]=ellipsoid(0,-.5*patient.Ltibia,0,patient.ltibia,patient.Ltibia,patient.ltibia,8,g),d.tibiaD.x)for(var ae in d.tibiaD.x[ee]){var ie=math.multiply(repere_patient.tibiaD,[d.tibiaD.x[ee][ae],d.tibiaD.y[ee][ae],d.tibiaD.z[ee][ae],1]);d.tibiaD.x[ee][ae]=ie[0],d.tibiaD.y[ee][ae]=ie[1],d.tibiaD.z[ee][ae]=ie[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.tibiaD.x.flat(),y:d.tibiaD.y.flat(),z:d.tibiaD.z.flat()},data.push(y)}for(u in d.tibiaG={},[0,1]){for(var re in[d.tibiaG.x,d.tibiaG.y,d.tibiaG.z]=ellipsoid(0,-.5*patient.Ltibia,0,patient.ltibia,patient.Ltibia,patient.ltibia,8,u),d.tibiaG.x)for(var te in d.tibiaG.x[re]){var se=math.multiply(repere_patient.tibiaG,[d.tibiaG.x[re][te],d.tibiaG.y[re][te],d.tibiaG.z[re][te],1]);d.tibiaG.x[re][te]=se[0],d.tibiaG.y[re][te]=se[1],d.tibiaG.z[re][te]=se[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.tibiaG.x.flat(),y:d.tibiaG.y.flat(),z:d.tibiaG.z.flat()},data.push(y)}for(_ in d.piedD={},[0,1]){for(var ne in[d.piedD.x,d.piedD.y,d.piedD.z]=ellipsoid(.25*patient.Lpied,-patient.Ltibia-.25*patient.lpied,0,patient.Lpied,patient.lpied,patient.lpied,8,_),d.piedD.x)for(var oe in d.piedD.x[ne]){var pe=math.multiply(repere_patient.tibiaD,[d.piedD.x[ne][oe],d.piedD.y[ne][oe],d.piedD.z[ne][oe],1]);d.piedD.x[ne][oe]=pe[0],d.piedD.y[ne][oe]=pe[1],d.piedD.z[ne][oe]=pe[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.piedD.x.flat(),y:d.piedD.y.flat(),z:d.piedD.z.flat()},data.push(y)}for(m in d.piedG={},[0,1]){for(var ce in[d.piedG.x,d.piedG.y,d.piedG.z]=ellipsoid(.25*patient.Lpied,-patient.Ltibia-.25*patient.lpied,0,patient.Lpied,patient.lpied,patient.lpied,8,m),d.piedG.x)for(var le in d.piedG.x[ce]){var he=math.multiply(repere_patient.tibiaG,[d.piedG.x[ce][le],d.piedG.y[ce][le],d.piedG.z[ce][le],1]);d.piedG.x[ce][le]=he[0],d.piedG.y[ce][le]=he[1],d.piedG.z[ce][le]=he[2]}y={type:"scatter3d",mode:"lines",surfaceaxis:1,line:{width:0},opacity:.6,x:d.piedG.x.flat(),y:d.piedG.y.flat(),z:d.piedG.z.flat()},data.push(y)}}function ellipsoid(e,a,i,r,t,s,n,o){var p,c=n,l=[[-Math.PI/2,0],[0,Math.PI/2]],n=makeArr(0,2*Math.PI,c),o=makeArr(l[o][0],l[o][1],c),h=Array(c).fill(n),g=Array(c).fill(o),g=math.transpose(g);let u=[],_=[],m=[];for(p in h)for(var d in u[p]=[],_[p]=[],m[p]=[],h[p])u[p][d]=Math.cos(g[p][d])*Math.sin(h[p][d])*r/2+e,_[p][d]=Math.cos(g[p][d])*Math.cos(h[p][d])*t/2+a,m[p][d]=Math.sin(g[p][d])*s/2+i;return[u,_,m]}function point_coude(){var e=reglage_patient.main.angle,a=patient.Lbras,i=patient.LavtBras,r=patient.Lmain,t=reglage_chair.roue.arr.MC_rayon,s=reglage_chair.roue.arr.MC_distance,n=repere_chair.roue.arr.d,o=repere_patient.brasD,p=matrice_Rotation("x",-90,4),p=math.multiply(p,o),o=(90-e)*Math.PI/180,e=t*Math.cos(o),o=t*Math.sin(o),o=math.multiply(n,[e,o,s,1]),s=math.lusolve(p,o),s=math.transpose(s),s=[p[0][2],p[1][2],p[2][2]],s=circle_sphere_intersection([p[0][3],p[1][3],p[2][3]],a,[o[0],o[1],o[2]],i+r,s);let c;if(2==s.length){let e=s[0];e.push(1);let a=s[1];a.push(1),c=e[0]<a[0]?e:a}else c=s,c.push(1);0==s&&(c=math.multiply(p,[0,0,a,1]),l=60*Math.PI/180,h=[0,(i+r)*Math.sin(l),a+(i+r)*Math.cos(l),1],math.multiply(p,h));var i=[c[0],c[1],-c[2],c[3]],r=[o[0],o[1],-o[2],o[3]],l=matrice_Rotation("x",90,4),h=math.transpose(p)[3],p=cal_repere_membre_sup(h,c,0);repere_patient.brasD=math.multiply(l,p);h=cal_repere_membre_sup([h[0],h[1],-h[2],h[3]],i,0);repere_patient.brasG=math.multiply(l,h);o=cal_repere_membre_sup(math.lusolve(p,c).flat(),math.lusolve(p,o).flat(),p),o=math.multiply(p,o);repere_patient.avtBrasD=math.multiply(l,o);r=cal_repere_membre_sup(math.lusolve(h,i).flat(),math.lusolve(h,r).flat(),h),r=math.multiply(h,r);repere_patient.avtBrasG=math.multiply(l,r)}function circle_sphere_intersection(e,a,i,r,t){let s;var n,o,p=math.dot(t,math.add(e,math.multiply(i,-1)));return Math.abs(p)>r?0:(n=math.add(i,math.multiply(p,t)),p==r?(o=math.norm(math.add(n,math.multiply(e,-1))),i=Math.sqrt(Math.pow(r,2)-Math.pow(p,2)),s=o==a+i?n:0):(r=Math.sqrt(Math.pow(r,2)-Math.pow(p,2)),p=vecteur_normalize(math.cross(math.add(n,math.multiply(e,-1)),t)),a+r<(t=math.norm(math.add(n,math.multiply(e,-1))))?0:s=t==a+r?math.mul(math.multiply(math.add(e,math.add(n,math.multiply(e,-1))),a),1/t):(r=.5+(Math.pow(a,2)-Math.pow(r,2))/(2*Math.pow(t,2)),e=math.add(e,math.multiply(r,math.add(n,math.multiply(e,-1)))),t=Math.sqrt(Math.pow(a,2)-Math.pow(r,2)*Math.pow(t,2)),[math.add(e,math.multiply(math.multiply(p,t),-1)),math.add(e,math.multiply(p,t))]))),s}function cal_repere_membre_sup(e,a,i){0==i&&(i=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]),e=e.slice(0,3),a=a.slice(0,3);var r=math.multiply(math.add(e,math.multiply(a,-1)),1/math.norm(math.add(e,math.multiply(a,-1))));let t=math.lusolve(i,[0,0,1,1]);t=t.slice(0,3);a=math.cross(r,t)[0],a=math.multiply(a,1/math.norm(a)),i=math.cross(a,r);let s=[a,r,i=math.multiply(i,1/math.norm(i)),e];return s=math.transpose(s),s.push([0,0,0,1]),s}function cal_repere_roue(e,a,i,r,t){t=t*Math.PI/180;i=[a,i,e*r],r=[0,Math.cos(-e*t),Math.sin(-e*t)],t=[0,-Math.sin(-e*t),Math.cos(-e*t)];let s=math.transpose([[1,0,0],r,t,i]);return s.push([0,0,0,1]),s}function cal_repere_assise(e,a,i,r){r=r*Math.PI/180,a=[e,a-i*Math.sin(r),0],i=[Math.cos(r),Math.sin(r),0],r=[-Math.sin(r),Math.cos(r),0];let t=math.transpose([i,r,[0,0,1],a]);return t.push([0,0,0,1]),t}function cal_repere_potence(e,a,i){i=(i-90)*Math.PI/180,e=[e+a*Math.sin(i),-a*Math.cos(i),0],a=[Math.cos(i),Math.sin(i),0],i=[-Math.sin(i),Math.cos(i),0];let r=math.transpose([a,i,[0,0,1],e]);return r.push([0,0,0,1]),r}function cal_repere_repose(e){var a=(90-e)*Math.PI/180,e=[Math.cos(a),Math.sin(a),0],a=[-Math.sin(a),Math.cos(a),0];let i=math.transpose([e,a,[0,0,1],[0,0,0]]);return i.push([0,0,0,1]),i}function matrice_transpose(i){return i[0].map(function(e,a){return i.map(function(e){return e[a]})})}function makeArr(e,a,i){for(var r=[],t=(a-e)/(i-1),s=0;s<i;s++)r.push(e+t*s);return r}function vecteur_normalize(e){let a=[];for(var i in e)a[i]=(e[i]-math.mean(e))/math.std(e);return a}function cercle(a,i,r,t){let s=Array();for(let e=0;e<=360;e+=10){var n=e*Math.PI/180,o=a[0]+i*Math.cos(n),p=a[1]+i*Math.sin(n),n=a[2]+r*t;s.push([o,p,n])}return s=matrice_transpose(s),s}function matSlice(e,a){let i=e.slice(0,3);return i=math.transpose(i),i=i.slice(0,3),i=math.transpose(i),i}function matComb(e,a){return[[e[0][0],e[0][1],e[0][2],a[0][3]],[e[1][0],e[1][1],e[1][2],a[1][3]],[e[2][0],e[2][1],e[2][2],a[2][3]],[a[3][0],a[3][1],a[3][2],a[3][3]]]}function matrice_Rotation(e,a,i){var r=a*Math.PI/180;let t=[];switch(e){case"x":t=[[1,0,0],[0,Math.cos(r),-Math.sin(r)],[0,Math.sin(r),Math.cos(r)]];break;case"y":t=[[Math.cos(r),0,Math.sin(r)],[0,1,0],[-Math.sin(r),0,Math.cos(r)]];break;case"z":t=[[Math.cos(r),-Math.sin(r),0],[Math.sin(r),Math.cos(r),0],[0,0,1]]}return 4==i&&(t.push([0,0,0]),t=matrice_transpose(t),t.push([0,0,0,1]),t=matrice_transpose(t)),t}function matrice_Translation(e,a,i){return[[1,0,0,e],[0,1,0,a],[0,0,1,i],[0,0,0,1]]}function init_layout(){return plotly_layout={hovermode:!1,margin:{t:0,l:0,b:0,r:0},autosize:!0,automargin:!0,showlegend:!1,scene:{xaxis:{showgrid:!1,showticklabels:!1,title:{text:""}},yaxis:{showgrid:!1,showticklabels:!1,title:{text:""}},zaxis:{showgrid:!1,showticklabels:!1,title:{text:""}},camera:{center:{x:0,y:0,z:-.1},eye:{x:1,y:1,z:1}}}},plotly_config={responsive:!0},[plotly_layout,plotly_config]}function rotation(){var r=document.getElementById("myPloty3DChart");!function e(){!function(e,a){var i=function(e){return{r:Math.sqrt(e.x*e.x+e.y*e.y),t:Math.atan2(e.y,e.x),z:e.z}}(r.layout[e].camera.eye);i.t+=a,i=function(e){return{x:e.r*Math.cos(e.t),y:e.r*Math.sin(e.t),z:e.z}}(i),Plotly.relayout(r,e+".camera.eye",i)}("scene",Math.PI/360),requestAnimationFrame(e)}()}function init_slider(){Array();for(let t in reglage_chair)for(let r in reglage_chair[t])for(let i in reglage_chair[t][r]){let e=document.getElementById("RangeInput_"+t+"_"+r+"_"+i),a=document.getElementById("RangeOutput_"+t+"_"+r+"_"+i);try{function s(){a=document.getElementById("RangeOutput_"+t+"_"+r+"_"+i),a.innerHTML=this.value,reglage_chair[t][r][i]=this.value,init_global()}e.value=reglage_chair[t][r][i],a.innerHTML=e.value,e.addEventListener("input",s)}catch(e){console.log(e)}}}init_coord(),init_layout(),init_global(),init_slider();